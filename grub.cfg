#
# ### !!! WARNING - READ ME !!! ###
#
# DO NOT edit this file. This file has been generated automatically by the loader generator.
# If you were asked to use a pre-made image and asked by someone to edit this file DO NOT do it. The only
# supported method of obtaining the loader image is generating it using the loader generator provided.
#
#####################################################################################
## Redpill Multi Bootloader v2.0.0-r02
## Modify FOXBI
## 2022.04.29
#====================================================================================
## Do not Change (initializing mac values)
#====================================================================================
set mac1=
set mac2=
set mac3=
set mac4=
#####################################################################################
function user_config {
	#====================================================================================
	## User config - Your values Change 
	## (if you want multi nic, change netif_num and blew # remove)
	#====================================================================================
	set sn=1234SQRDD5678
	set SataPortMap=9
	set DiskIdxMap=0
	set SasIdxMap=0
	set netif_num=1
	set mac1=001122334455
	#set mac2=001122334466
	#set mac3=001122334477
	#set mac4=001122334488	
	#====================================================================================
	## USB use only
	#====================================================================================
	set pid=0xa4a5
	set vid=0x0525
	#====================================================================================
	## SATA Boot Priority (default : loader (1:0), data (0:0) )
	#====================================================================================
	set shd=hd1
	#====================================================================================
	## USB Boot Priority
	#====================================================================================
	set uhd=hd0
}
function serial_config {
	#====================================================================================
	## COM Port for serial connect (eg. com1 -> 1, com3 -> 3, default:1)
	#====================================================================================
	set com=1
}
#####################################################################################
## Do not Change !!! (serial com port check)
#====================================================================================
function serial_args {
	serial_config
	if [ $com -eq 1 ]; then
		comt=ttyS0
		comp=0x3f8
		com=0
	elif [ $com -eq 2 ]; then
		comt=ttyS1
		comp=0x2f8
		com=1
	elif [ $com -eq 3 ]; then
		comt=ttyS2
		comp=0x3e8
		com=2
	elif [ $com -eq 4 ]; then
		comt=ttyS3
		comp=0x2e8
		com=3
	elif [ $com -eq 5 ]; then
		comt=ttyS4
		comp=0xff0
		com=4
	else
		comt=ttyS0
		comp=0x3f8
		com=0
	fi
	# ttyS0 at 0x3f8 com1
	# ttyS1 at 0x2f8 com2
	# ttyS2 at 0x3e8 com3
	# ttyS3 at 0x2e8 com4
	# ttyS4 at 0xff0 com5
}
#====================================================================================
## Do not Change!!! (auto check multi netif add args values)
#====================================================================================
function cmdline_args {
	user_config
	if [ $netif_num -gt 1 ]; then
		if [ -z "$mac4" ]; then
			if [ -z "$mac3" ]; then
				if [ -z "$mac2" ]; then
					mac1="$mac1"
				else
					mac1="$mac1 mac2=$mac2"
				fi
			else
				if [ -z "$mac2" ]; then
					mac1="$mac1 mac3=$mac3"
				else
					mac1="$mac1 mac2=$mac2 mac3=$mac3"
				fi
			fi
		else
			if [ -z "$mac3" ]; then
				if [ -z "$mac2" ]; then
					mac1="$mac1 mac4=$mac4"
				else
					mac1="$mac1 mac2=$mac2 mac4=$mac4"
				fi
			else
				if [ -z "$mac2" ]; then
					mac1="$mac1 mac3=$mac3 mac4=$mac4"
				else
					mac1="$mac1 mac2=$mac2 mac3=$mac3 mac4=$mac4"
				fi
			fi
		fi
	else
		mac1="$mac1"
	fi
	serial_args
	set user_args1="console=$comt,115200n8 netif_num=$netif_num pid=$pid earlycon=uart8250,io,$comp,115200n8"	
	set user_args2="mac1=$mac1 sn=$sn vid=$vid DiskIdxMap=$DiskIdxMap SasIdxMap=$SasIdxMap SataPortMap=$SataPortMap"
	eval "set user_args=\"\$user_args1 $user_args2\""
	eval "set shd=\"\$shd\""
	eval "set uhd=\"\$uhd\""
}
#====================================================================================
## Do not Change!!! (serial config)
#====================================================================================
terminal_output console
## serial function call
serial_args
if serial --unit=$com --speed=115200; then
    terminal_input --append serial_com$com
    terminal_output --append serial_com$com
fi
#####################################################################################

set default="0"
set timeout="5"
set timeout_style="menu"

if [ -s $prefix/grubenv ]; then
    load_env --file $prefix/grubenv --skip-sig
    set has_env="1"
    if [ -n "${saved_entry}" ]; then
        set default="${saved_entry}"
    fi
else
    set has_env="0"
    echo "WARN: failed to load env. Default choice will NOT be saved!"
fi


function savedefault {
    saved_entry="${chosen}"
    save_env --file $prefix/grubenv saved_entry
	# useconfig call
	cmdline_args
}

insmod usb_keyboard
insmod part_msdos
insmod ext2
insmod fat
insmod linux
insmod gzio
# UEFI Check
if [ $grub_platform = efi ]; then
	insmod efi_gop
	insmod efi_uga
else
	set gfxmode=auto
	insmod vbe
	insmod vga
fi
#####################################################################################
## if you want ubuntu style font blew # remove
#####################################################################################
#insmod font
#if loadfont ${prefix}/fonts/unicode.pf2
#then
#    insmod gfxterm
#    set gfxmode=auto
#    set gfxpayload=keep
#    terminal_output gfxterm
#fi
#####################################################################################

menuentry 'RedPill DS918+ v7.1.0-42661 (SATA, Verbose)' {
	savedefault
	set root=($shd,msdos1)
	echo Loading Linux...
	linux /Model/ds918p/zImage withefi earlyprintk syno_hw_version=DS918+ synoboot_satadom=2 syno_port_thaw=1 elevator=elevator loglevel=15 HddHotplug=0 syno_hdd_detect=0 vender_format_version=2 syno_hdd_powerup_seq=1 log_buf_len=32M root=/dev/md0 $user_args
	echo Loading initramfs...
	initrd /Model/ds918p/rd.gz /Model/ds918p/custom.gz
	echo Starting kernel with SATA boot
	echo WARNING: SATA boot support on this platform is experimental!
}

menuentry 'RedPill DS920+ v7.1.0-42661 (SATA, Verbose)' {
	savedefault
	set root=($shd,msdos1)
	echo Loading Linux...
	linux /Model/ds920p/zImage earlyprintk syno_hw_version=DS920+ synoboot2 synoboot_satadom=2 HddEnableDynamicPower=1 elevator=elevator loglevel=15 intel_iommu=igfx_off vender_format_version=2 log_buf_len=32M root=/dev/md0 syno_ttyS1=serial,0x2f8 syno_ttyS0=serial,0x3f8 $user_args
	echo Loading initramfs...
	initrd /Model/ds920p/rd.gz /Model/ds920p/custom.gz
	echo Starting kernel with SATA boot
	echo WARNING: SATA boot support on this platform is experimental!
}

menuentry 'RedPill DS1621+ v7.1.0-42661 (SATA, Verbose)' {
	savedefault
	set root=($shd,msdos1)
	echo Loading Linux...
	linux /Model/ds1621p/zImage earlyprintk syno_hw_version=DS1621+ synoboot2 synoboot_satadom=2 SMBusHddDynamicPower=1 elevator=elevator loglevel=15 vender_format_version=2 log_buf_len=32M root=/dev/md0 syno_ttyS1=serial,0x2f8 syno_ttyS0=serial,0x3f8 $user_args
	echo Loading initramfs...
	initrd /Model/ds1621p/rd.gz /Model/ds1621p/custom.gz
	echo Starting kernel with SATA boot
	echo WARNING: SATA boot support on this platform is experimental!
}

menuentry 'RedPill DS3615xs v7.1.0-42661 (SATA, Verbose)' {
	savedefault
	set root=($shd,msdos1)
	echo Loading Linux...
	linux /Model/ds3615xs/zImage withefi earlyprintk syno_hw_version=DS3615xs synoboot_satadom=1 syno_port_thaw=1 elevator=elevator loglevel=15 HddHotplug=0 syno_hdd_detect=0 vender_format_version=2 syno_hdd_powerup_seq=0 log_buf_len=32M root=/dev/md0 $user_args
	echo Loading initramfs...
	initrd /Model/ds3615xs/rd.gz /Model/ds3615xs/custom.gz
	echo Starting kernel with SATA boot
}

menuentry 'RedPill DS3617xs v7.1-42661 Beta (SATA, Verbose)' {
	savedefault
	set root=($shd,msdos1)
	echo Loading Linux...
	linux /Model/ds3617xs/zImage withefi earlyprintk syno_hw_version=DS3617xs synoboot_satadom=1 syno_port_thaw=1 elevator=elevator loglevel=15 HddHotplug=0 syno_hdd_detect=0 vender_format_version=2 syno_hdd_powerup_seq=0 log_buf_len=32M root=/dev/md0 $user_args 
	echo Loading initramfs...
	initrd /Model/ds3617xs/rd.gz /Model/ds3617xs/custom.gz
	echo Starting kernel with SATA boot
}

menuentry 'RedPill DS3622xs v7.1.0-42661 Beta (SATA, Verbose)' {
	savedefault
	set root=($shd,msdos1)
	echo Loading Linux...
	linux /Model/ds3622xsp/zImage withefi earlyprintk syno_hw_version=DS3622xs+ synoboot_satadom=1 syno_port_thaw=1 elevator=elevator loglevel=15 HddHotplug=0 syno_hdd_detect=0 vender_format_version=2 syno_hdd_powerup_seq=0 log_buf_len=32M root=/dev/md0 $user_args 
	echo Loading initramfs...
	initrd /Model/ds3622xsp/rd.gz /Model/ds3622xsp/custom.gz
	echo Starting kernel with SATA boot
}

menuentry 'RedPill DVA3221 v7.1.0-42661 Beta (SATA, Verbose)' {
	savedefault
	set root=($shd,msdos1)
	echo Loading Linux...
	linux /Model/dva3221/zImage withefi earlyprintk syno_hw_version=DVA3221 synoboot_satadom=2 syno_port_thaw=1 elevator=elevator loglevel=15 HddHotplug=0 syno_hdd_detect=0 vender_format_version=2 syno_hdd_powerup_seq=0 log_buf_len=32M root=/dev/md0 $user_args 
	echo Loading initramfs...
	initrd /Model/dva3221/rd.gz /Model/dva3221/custom.gz
	echo Starting kernel with SATA boot
}

submenu 'USB Redpill Bootloader' {
	menuentry 'RedPill DS918+ v7.1.0-42661 (USB, Verbose)' {
		savedefault
		set root=($uhd,msdos1)
		echo Loading Linux...
		linux /Model/ds918p/zImage withefi earlyprintk syno_hw_version=DS918+ syno_port_thaw=1 elevator=elevator loglevel=15 HddHotplug=0 syno_hdd_detect=0 vender_format_version=2 syno_hdd_powerup_seq=1 log_buf_len=32M root=/dev/md0 $user_args 
		echo Loading initramfs...
		initrd /Model/ds918p/rd.gz /Model/ds918p/custom.gz
		echo Starting kernel with USB boot
	}

	menuentry 'RedPill DS920+ v7.1.0-42661 (USB, Verbose)' {
		savedefault
		set root=($uhd,msdos1)
		echo Loading Linux...
		linux /Model/ds920p/zImage earlyprintk syno_hw_version=DS920+ synoboot2 HddEnableDynamicPower=1 elevator=elevator loglevel=15 intel_iommu=igfx_off vender_format_version=2 log_buf_len=32M root=/dev/md0 syno_ttyS1=serial,0x2f8 syno_ttyS0=serial,0x3f8 $user_args 
		echo Loading initramfs...
		initrd /Model/ds920p/rd.gz /Model/ds920p/custom.gz
		echo Starting kernel with USB boot
	}

	menuentry 'RedPill DS1621+ v7.1.0-42661 (USB, Verbose)' {
		savedefault
		set root=($uhd,msdos1)
		echo Loading Linux...
		linux /Model/ds1621p/zImage earlyprintk syno_hw_version=DS1621+ synoboot2 SMBusHddDynamicPower=1 elevator=elevator loglevel=15 vender_format_version=2 log_buf_len=32M root=/dev/md0 syno_ttyS1=serial,0x2f8 syno_ttyS0=serial,0x3f8 $user_args 
		echo Loading initramfs...
		initrd /Model/ds1621p/rd.gz /Model/ds1621p/custom.gz
		echo Starting kernel with USB boot
	}

	menuentry 'RedPill DS3615xs v7.1.0-42661 (USB, Verbose)' {
		savedefault
		set root=($uhd,msdos1)
		echo Loading Linux...
		linux /Model/ds3615xs/zImage withefi earlyprintk syno_hw_version=DS3615xs syno_port_thaw=1 elevator=elevator loglevel=15 HddHotplug=0 syno_hdd_detect=0 vender_format_version=2 syno_hdd_powerup_seq=0 log_buf_len=32M root=/dev/md0 $user_args  
		echo Loading initramfs...
		initrd /Model/ds3615xs/rd.gz /Model/ds3615xs/custom.gz
		echo Starting kernel with USB boot
	}

	menuentry 'RedPill DS3617xs v7.1-42661 Beta (USB, Verbose)' {
		savedefault
		set root=($uhd,msdos1)
		echo Loading Linux...
		linux /Model/ds3617xs/zImage withefi earlyprintk syno_hw_version=DS3617xs syno_port_thaw=1 elevator=elevator loglevel=15 HddHotplug=0 syno_hdd_detect=0 vender_format_version=2 syno_hdd_powerup_seq=0 log_buf_len=32M root=/dev/md0 $user_args  
		echo Loading initramfs...
		initrd /Model/ds3617xs/rd.gz /Model/ds3617xs/custom.gz
		echo Starting kernel with USB boot
	}

	menuentry 'RedPill DS3622xs v7.1.0-42661 Beta (USB, Verbose)' {
		savedefault
		set root=($uhd,msdos1)
		echo Loading Linux...
		linux /Model/ds3622xsp/zImage withefi earlyprintk syno_hw_version=DS3622xs+ syno_port_thaw=1 elevator=elevator loglevel=15 HddHotplug=0 syno_hdd_detect=0 vender_format_version=2 syno_hdd_powerup_seq=0 log_buf_len=32M root=/dev/md0 $user_args  
		echo Loading initramfs...
		initrd /Model/ds3622xsp/rd.gz /Model/ds3622xsp/custom.gz
		echo Starting kernel with USB boot
	}

	menuentry 'RedPill DVA3221 v7.1.0-42661 Beta (USB, Verbose)' {
		savedefault
		set root=($uhd,msdos1)
		echo Loading Linux...
		linux /Model/dva3221/zImage withefi earlyprintk syno_hw_version=DVA3221 syno_port_thaw=1 elevator=elevator loglevel=15 HddHotplug=0 syno_hdd_detect=0 vender_format_version=2 syno_hdd_powerup_seq=0 log_buf_len=32M root=/dev/md0 $user_args  
		echo Loading initramfs...
		initrd /Model/dva3221/rd.gz /Model/dva3221/custom.gz
		echo Starting kernel with USB boot
	}
}